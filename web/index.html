<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3E🎵%3C/text%3E%3C/svg%3E" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music Formula Generator</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header>
    <h1>Music Formula Generator</h1>
    <p class="tagline">Your creative studio for songwriting formulas</p>
  </header>

  <div class="toolbar header-actions" role="group" aria-label="App controls">
    <span class="brand">RGF</span>
    <div class="spacer"></div>
    <div class="tabs segmented" role="tablist" aria-label="Primary views">
      <button type="button" id="tab-inputs" role="tab" aria-selected="true">Inputs</button>
      <button type="button" id="tab-outputs" role="tab" aria-selected="false">Outputs</button>
      <button type="button" id="tab-ai" role="tab" aria-selected="false">AI</button>
    </div>
    <div class="spacer"></div>

    <!-- View dropdown -->
    <div class="dropdown" id="view-dropdown">
      <button type="button" class="dropdown-toggle">View</button>
      <div class="dropdown-menu">
        <button type="button" id="collapse-all">Collapse All</button>
        <button type="button" id="expand-all">Expand All</button>
        <div class="separator"></div>
        <button type="button" id="wizard-toggle">Wizard Mode</button>
        <button type="button" id="mode-toggle">Advanced Mode</button>
        <button type="button" id="demo-mode">Demo Mode</button>
      </div>
    </div>

    <!-- Settings dropdown -->
    <div class="dropdown" id="settings-dropdown">
      <button type="button" class="dropdown-toggle">Settings</button>
      <div class="dropdown-menu">
        <button type="button" id="motion-toggle">Motion</button>
        <button type="button" id="emoji-toggle">Emoji</button>
        <button type="button" id="theme-toggle">Theme</button>
        <div class="separator"></div>
        <button type="button" id="save-state">Save State</button>
        <button type="button" id="load-state">Load State</button>
        <button type="button" id="reset-state">Reset State</button>
        <div class="separator"></div>
        <button type="button" id="export-json">📥 Export Config</button>
        <button type="button" id="import-json">📤 Import Config</button>
        <div class="separator"></div>
        <button type="button" id="show-shortcuts">⌨️ Keyboard Shortcuts</button>
      </div>
    </div>

    <!-- Games dropdown -->
    <div class="dropdown" id="games-dropdown">
      <button type="button" class="dropdown-toggle">Games <span id="brick-breaker-indicator" hidden style="display:inline-block; width:8px; height:8px; margin-left:6px; border-radius:50%; background:#00c853; box-shadow:0 0 0 2px rgba(0,0,0,0.2);"></span></button>
      <div class="dropdown-menu">
        <button type="button" id="import-brick-breaker">Import from Brick Breaker</button>
        <button type="button" id="open-games">Play Games</button>
        <button type="button" id="open-trophies">View Trophies</button>
        <button type="button" id="open-guide">Trophy Guide</button>
      </div>
    </div>
  </div>

  <!-- Readiness meter (guides new users) -->
  <div class="readiness" aria-label="Project readiness">
    <div class="readiness-row">
      <span class="readiness-label">Readiness</span>
      <span class="readiness-value" id="readiness-value">0%</span>
    </div>
    <div class="readiness-track"><div class="readiness-bar" id="readiness-bar" style="width:0%"></div></div>
  </div>

  <!-- Wizard progress bar -->
  <div id="wizard-bar" class="wizard-bar" hidden>
    <div class="wizard-steps" role="progressbar" aria-valuemin="0" aria-valuemax="4" aria-valuenow="0">
      <div class="wizard-step" data-step="0"><span>Preset & Weights</span></div>
      <div class="wizard-step" data-step="1"><span>Genre Mix</span></div>
      <div class="wizard-step" data-step="2"><span>Premise & Accent</span></div>
      <div class="wizard-step" data-step="3"><span>User Sections</span></div>
      <div class="wizard-step" data-step="4"><span>Build</span></div>
    </div>
    <div class="wizard-actions">
      <button type="button" id="wizard-prev">Back</button>
      <button type="button" id="wizard-next" class="btn-primary">Next</button>
      <button type="button" id="wizard-fix" title="Fix requirements" hidden>Fix It</button>
      <div id="wizard-hint" class="wizard-hint" aria-live="polite"></div>
    </div>
  </div>

  <section class="hero">
    <div class="hero-inner">
      <h2 class="hero-title">Write smarter. Score better.</h2>
      <p class="hero-sub">Blend genres, score concepts, and export ready-to-use Suno blocks &mdash; in a refined, minimal workspace.</p>
      <div class="hero-actions">
        <button type="button" id="open-genre-library-hero" class="btn-primary">Browse Genres</button>
        <button type="button" id="build-prompt-hero">Build Prompt</button>
        <button type="button" id="demo-mode-hero">Try Demo</button>
      </div>
    </div>
  </section>
  

  <main class="layout">
    <section class="panel" id="scoring-panel">
      <h2>Scoring Inputs</h2>
      <div class="panel-group">
        <section data-mode="advanced">
          <h3>Constants &amp; Controls</h3>
          <div id="constants"></div>
          <div id="controls"></div>
        </section>
        <section data-mode="advanced">
          <h3>Weights</h3>
          <div id="weights"></div>
          <div class="inline-buttons segmented">
            <button type="button" data-preset="street">Street</button>
            <button type="button" data-preset="club">Club</button>
            <button type="button" data-preset="backpack">Backpack</button>
            <button type="button" data-preset="streaming">Streaming</button>
            <button type="button" data-preset="defaults">Reset Defaults</button>
          </div>
        </section>
        <section data-mode="advanced">
          <h3>Base Inputs (0-10)</h3>
          <div id="base-inputs"></div>
        </section>
        <section data-mode="advanced">
          <h3>Derived Inputs (0-1)</h3>
          <div id="derived-inputs"></div>
        </section>
        <section>
          <h3>Creative Brief Inputs</h3>
          <div id="creative-inputs"></div>
        </section>
        <section>
          <h3>Genre Mix</h3>
          <div id="genre-mix"></div>
          <p class="hint">Weights should total 100%. Use the sliders or enter values directly.</p>
          <div class="inline-buttons">
            <button type="button" id="open-genre-library">View Library</button>
            <button type="button" id="apply-genre-mix">Apply Genre Mix</button>
            <button type="button" id="open-accent-library">Accent Library</button>
            <button type="button" id="genre-suggest" title="Suggest a genre blend">Suggest Blend</button>
            <button type="button" id="genre-presets" title="Pick from curated blends">Blend Presets</button>
          </div>
        </section>
        <section>
          <h3>Premise &amp; Phonetics</h3>
          <label class="field">
            <span>Premise</span>
            <select id="premise-select"></select>
            <button type="button" id="premise-suggest" title="Suggest a premise" style="margin-left:8px">Suggest</button>
          </label>
          <label class="field">
            <span>Musical Key</span>
            <select id="musical-key-select"></select>
          </label>
          <label class="field">
            <span>Language</span>
            <select id="language-select"></select>
          </label>
          <label class="field">
            <span>Phonetic Accent</span>
            <select id="accent-select"></select>
          </label>
        </section>
        <section>
          <h3>User Sections (lock lyrics verbatim)</h3>
          <div id="user-sections"></div>
        </section>
      </div>
    </section>

    <section class="panel" id="outputs-panel">
      <h2>Scores &amp; Outputs</h2>
      <div class="inline-buttons" style="margin-bottom:0.5rem">
        <button type="button" id="back-to-inputs" title="Return to inputs">Back to Inputs</button>
      </div>
      <div class="panel-group">
        <section data-mode="advanced">
          <h3>Computed Scores</h3>
          <div id="computed-scores"></div>
        </section>
        <section id="creative-brief-section">
          <h3>Creative Brief</h3>
          <div class="actions">
            <button type="button" id="generate-brief" class="btn-primary">Make Brief</button>
            <button type="button" id="copy-brief" title="Copy Creative Brief to clipboard">Copy</button>
          </div>
          <pre id="creative-brief" class="output-block"></pre>
        </section>
        <section id="suno-section">
          <h3>Suno Export Blocks</h3>
          <div class="actions">
            <button type="button" id="generate-suno" class="btn-primary">Make Suno</button>
            <button type="button" id="copy-suno" title="Copy Suno blocks to clipboard">Copy</button>
          </div>
          <pre id="suno-output" class="output-block"></pre>
        </section>
        <section id="ai-prompt-section">
          <h3>AI Prompt Workspace</h3>
          <div class="actions">
            <button type="button" id="build-prompt" class="btn-primary">Build Prompt</button>
            <button type="button" id="copy-ai-prompt" title="Copy AI prompt to clipboard">Copy</button>
          </div>
          <pre id="ai-prompt" class="output-block"></pre>
        </section>
        <section id="prompt-history-section">
          <h3>Prompt History</h3>
          <div class="actions">
            <button type="button" id="clear-prompt-history" title="Remove all saved prompts">Clear History</button>
          </div>
          <div id="prompt-history-list"></div>
        </section>
        <section id="ai-call-section" data-mode="advanced">
          <h3>Call AI (Optional)</h3>
          <div class="warning-box" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(255, 193, 7, 0.1); border-left: 3px solid #ffc107; font-size: 0.9rem;">
            <strong>⚠️ Security Notice:</strong> API keys are stored in browser localStorage. Only use this feature on personal devices. Your API key is never sent to our servers—it's used only for direct API calls from your browser.
          </div>
          <form id="ai-settings" class="grid-form">
            <label><span>Endpoint URL</span><input type="url" name="endpoint"></label>
            <label><span>Model</span><input type="text" name="model"></label>
            <label><span>API Key (Bearer)</span><input type="password" name="apiKey" autocomplete="off"></label>
            <label><span>Organization (optional)</span><input type="text" name="organization"></label>
            <label><span>Temperature</span><input type="number" step="0.01" name="temperature"></label>
            <label><span>Top P</span><input type="number" step="0.01" name="topP"></label>
            <label><span>Frequency Penalty</span><input type="number" step="0.01" name="frequencyPenalty"></label>
            <label><span>Presence Penalty</span><input type="number" step="0.01" name="presencePenalty"></label>
            <label><span>Max Tokens</span><input type="number" name="maxTokens"></label>
            <label><span>Request Timeout (ms)</span><input type="number" name="timeoutMs"></label>
            <label class="span-2"><span>System Prompt</span><textarea name="systemPrompt" rows="3"></textarea></label>
            <label class="span-2"><span>Stop Sequences (comma)</span><input type="text" name="stopSequences"></label>
            <label><span>User Label (optional)</span><input type="text" name="userLabel"></label>
            <label><span>Response Format (JSON)</span><input type="text" name="responseFormat"></label>
          </form>
          <div class="actions">
            <button type="button" id="call-ai" class="btn-primary">Call AI</button>
            <button type="button" id="copy-ai-response" title="Copy AI response to clipboard">Copy</button>
          </div>
          <pre id="ai-response" class="output-block"></pre>
        </section>
      </div>
    </section>
  </main>

  <dialog id="library-dialog">
    <div class="dialog-header">
      <h2 id="dialog-title"></h2>
      <button type="button" id="close-dialog" aria-label="Close">&times;</button>
    </div>
    <div id="dialog-content"></div>
  </dialog>

  <!-- Onboarding overlay -->
  <dialog id="onboarding-dialog">
    <div class="dialog-header">
      <h2>Welcome to RGF</h2>
      <button type="button" id="onboarding-close" aria-label="Close">&times;</button>
    </div>
    <div id="onboarding-content">
      <ol class="onboarding-steps">
        <li><strong>Pick a vibe</strong>: set weights or choose a preset.</li>
        <li><strong>Mix genres</strong>: add 1–3 genres and weights.</li>
        <li><strong>Set premise & accent</strong>: optional language + accent.</li>
        <li><strong>Build Prompt</strong>: see outputs and copy blocks.</li>
      </ol>
      <div class="actions">
        <button type="button" id="onboarding-demo" class="btn-primary">Load Demo</button>
        <button type="button" id="onboarding-gotit">Got it</button>
      </div>
    </div>
  </dialog>

  <!-- Brick Breaker Import Modal -->
  <dialog id="brick-breaker-import-dialog">
    <div class="dialog-header">
      <h2>🎮 Import from Brick Breaker</h2>
      <button type="button" id="close-brick-breaker-dialog" aria-label="Close">&times;</button>
    </div>
    <div class="dialog-content">
      <p id="brick-breaker-intro" style="margin-bottom: 15px;">
        You've collected musical elements while playing 3D Brick Breaker! Would you like to import them?
      </p>

      <div id="brick-breaker-stats" style="background: var(--bg-secondary, #f5f5f5); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <strong>Collected Elements:</strong>
        <div id="brick-breaker-preview" style="margin-top: 10px; font-size: 14px;"></div>
      </div>

      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button type="button" id="brick-breaker-dismiss" class="btn-secondary">Dismiss</button>
        <button type="button" id="brick-breaker-import" class="btn-primary">Import All</button>
      </div>

      <p style="margin-top: 15px; font-size: 12px; opacity: 0.7;">
        <em>Collected <span id="brick-breaker-age">recently</span>. Genres will be added to Genre Mix, other elements as keywords.</em>
      </p>
    </div>
  </dialog>

  <footer>
    <p>RGF web build &copy; iMob Worldwide &mdash; ported from the VBA module.</p>
  </footer>

  <!-- Toast notifications -->
  <div id="toast-root" aria-live="polite" aria-atomic="true"></div>
  <!-- Hidden directive for phonetic rewrites (not displayed) -->
  <div id="hidden-phonetic-directive" aria-hidden="true" style="display:none"></div>
  <script type="module" src="./app.js"></script>
</body>
</html>


