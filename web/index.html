<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RGF Music Formula Generator</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header>
    <h1>RGF Music Formula Generator</h1>
    <p class="tagline">A clean, Apple-inspired songwriting cockpit</p>
  </header>

  <div class="toolbar header-actions" role="group" aria-label="App controls">
    <span class="brand">RGF</span>
    <div class="spacer"></div>
    <div class="tabs segmented" role="tablist" aria-label="Primary views">
      <button type="button" id="tab-inputs" role="tab" aria-selected="true">Inputs</button>
      <button type="button" id="tab-outputs" role="tab" aria-selected="false">Outputs</button>
      <button type="button" id="tab-ai" role="tab" aria-selected="false">AI</button>
    </div>
    <div class="spacer"></div>
    <button type="button" id="motion-toggle" title="Toggle reduce motion">Motion</button>
    <button type="button" id="wizard-toggle" title="Toggle Wizard Mode">Wizard</button>
    <button type="button" id="demo-mode" title="Load demo settings">Demo</button>
    <button type="button" id="open-trophies" title="View achievements">Trophies</button>
    <button type="button" id="open-guide" title="How to earn trophies">Guide</button>
    <button type="button" id="collapse-all" title="Collapse all sections">Collapse</button>
    <button type="button" id="expand-all" title="Expand all sections">Expand</button>
    <button type="button" id="save-state" title="Save current settings to this browser">Save</button>
    <button type="button" id="load-state" title="Load settings saved in this browser">Load</button>
    <button type="button" id="reset-state" title="Reset to defaults">Reset</button>
    <button type="button" id="theme-toggle" title="Toggle dark mode">Theme</button>
  </div>

  <!-- Readiness meter (guides new users) -->
  <div class="readiness" aria-label="Project readiness">
    <div class="readiness-row">
      <span class="readiness-label">Readiness</span>
      <span class="readiness-value" id="readiness-value">0%</span>
    </div>
    <div class="readiness-track"><div class="readiness-bar" id="readiness-bar" style="width:0%"></div></div>
  </div>

  <!-- Wizard progress bar -->
  <div id="wizard-bar" class="wizard-bar" hidden>
    <div class="wizard-steps" role="progressbar" aria-valuemin="0" aria-valuemax="4" aria-valuenow="0">
      <div class="wizard-step" data-step="0"><span>Preset & Weights</span></div>
      <div class="wizard-step" data-step="1"><span>Genre Mix</span></div>
      <div class="wizard-step" data-step="2"><span>Premise & Accent</span></div>
      <div class="wizard-step" data-step="3"><span>User Sections</span></div>
      <div class="wizard-step" data-step="4"><span>Build</span></div>
    </div>
    <div class="wizard-actions">
      <button type="button" id="wizard-prev">Back</button>
      <button type="button" id="wizard-next" class="btn-primary">Next</button>
      <div id="wizard-hint" class="wizard-hint" aria-live="polite"></div>
    </div>
  </div>

  <section class="hero">
    <div class="hero-inner">
      <h2 class="hero-title">Write smarter. Score better.</h2>
      <p class="hero-sub">Blend genres, score concepts, and export ready-to-use Suno blocks &mdash; in a refined, minimal workspace.</p>
      <div class="hero-actions">
        <button type="button" id="open-genre-library-hero" class="btn-primary">Browse Genres</button>
        <button type="button" id="build-prompt-hero">Build Prompt</button>
        <button type="button" id="demo-mode-hero">Try Demo</button>
      </div>
    </div>
  </section>
  

  <main class="layout">
    <section class="panel" id="scoring-panel">
      <h2>Scoring Inputs</h2>
      <div class="panel-group">
        <section>
          <h3>Constants &amp; Controls</h3>
          <div id="constants"></div>
          <div id="controls"></div>
        </section>
        <section>
          <h3>Weights</h3>
          <div id="weights"></div>
          <div class="inline-buttons segmented">
            <button type="button" data-preset="street">Street</button>
            <button type="button" data-preset="club">Club</button>
            <button type="button" data-preset="backpack">Backpack</button>
            <button type="button" data-preset="streaming">Streaming</button>
            <button type="button" data-preset="defaults">Reset Defaults</button>
          </div>
        </section>
        <section>
          <h3>Base Inputs (0-10)</h3>
          <div id="base-inputs"></div>
        </section>
        <section>          <h3>Derived Inputs (0-1)</h3>          <div id="derived-inputs"></div>        </section>        <section>          <h3>Creative Brief Inputs</h3>          <div id="creative-inputs"></div>        </section>
        <section>
          <h3>Genre Mix</h3>
          <div id="genre-mix"></div>
          <p class="hint">Weights should total 100%. Use the sliders or enter values directly.</p>
          <div class="inline-buttons">
            <button type="button" id="open-genre-library">View Library</button>
            <button type="button" id="apply-genre-mix">Apply Genre Mix</button>
            <button type="button" id="open-accent-library">Accent Library</button>
            <button type="button" id="genre-suggest" title="Suggest a genre blend">Suggest Blend</button>
            <button type="button" id="genre-presets" title="Pick from curated blends">Blend Presets</button>
          </div>
        </section>
        <section>
          <h3>Premise &amp; Phonetics</h3>
          <label class="field">
            <span>Premise</span>
            <select id="premise-select"></select>
            <button type="button" id="premise-suggest" title="Suggest a premise" style="margin-left:8px">Suggest</button>
          </label>
          <label class="field">
            <span>Language</span>
            <select id="language-select"></select>
          </label>
          <label class="field">
            <span>Phonetic Accent</span>
            <select id="accent-select"></select>
          </label>
        </section>
        <section>
          <h3>User Sections (lock lyrics verbatim)</h3>
          <div id="user-sections"></div>
        </section>
      </div>
    </section>

    <section class="panel" id="outputs-panel">
      <h2>Scores &amp; Outputs</h2>
      <div class="inline-buttons" style="margin-bottom:0.5rem">
        <button type="button" id="back-to-inputs" title="Return to inputs">Back to Inputs</button>
      </div>
      <div class="panel-group">
        <section>
          <h3>Computed Scores</h3>
          <div id="computed-scores"></div>
        </section>
        <section id="creative-brief-section">
          <h3>Creative Brief</h3>
          <div class="actions">
            <button type="button" id="generate-brief" class="btn-primary">Make Brief</button>
            <button type="button" id="copy-brief" title="Copy Creative Brief to clipboard">Copy</button>
          </div>
          <pre id="creative-brief" class="output-block"></pre>
        </section>
        <section id="suno-section">
          <h3>Suno Export Blocks</h3>
          <div class="actions">
            <button type="button" id="generate-suno" class="btn-primary">Make Suno</button>
            <button type="button" id="copy-suno" title="Copy Suno blocks to clipboard">Copy</button>
          </div>
          <pre id="suno-output" class="output-block"></pre>
        </section>
        <section id="ai-prompt-section">
          <h3>AI Prompt Workspace</h3>
          <div class="actions">
            <button type="button" id="build-prompt" class="btn-primary">Build Prompt</button>
            <button type="button" id="copy-ai-prompt" title="Copy AI prompt to clipboard">Copy</button>
          </div>
          <pre id="ai-prompt" class="output-block"></pre>
        </section>
        <section id="prompt-history-section">
          <h3>Prompt History</h3>
          <div class="actions">
            <button type="button" id="clear-prompt-history" title="Remove all saved prompts">Clear History</button>
          </div>
          <div id="prompt-history-list"></div>
        </section>
        <section id="ai-call-section">
          <h3>Call AI (Optional)</h3>
          <form id="ai-settings" class="grid-form">
            <label><span>Endpoint URL</span><input type="url" name="endpoint"></label>
            <label><span>Model</span><input type="text" name="model"></label>
            <label><span>API Key (Bearer)</span><input type="password" name="apiKey"></label>
            <label><span>Organization (optional)</span><input type="text" name="organization"></label>
            <label><span>Temperature</span><input type="number" step="0.01" name="temperature"></label>
            <label><span>Top P</span><input type="number" step="0.01" name="topP"></label>
            <label><span>Frequency Penalty</span><input type="number" step="0.01" name="frequencyPenalty"></label>
            <label><span>Presence Penalty</span><input type="number" step="0.01" name="presencePenalty"></label>
            <label><span>Max Tokens</span><input type="number" name="maxTokens"></label>
            <label><span>Request Timeout (ms)</span><input type="number" name="timeoutMs"></label>
            <label class="span-2"><span>System Prompt</span><textarea name="systemPrompt" rows="3"></textarea></label>
            <label class="span-2"><span>Stop Sequences (comma)</span><input type="text" name="stopSequences"></label>
            <label><span>User Label (optional)</span><input type="text" name="userLabel"></label>
            <label><span>Response Format (JSON)</span><input type="text" name="responseFormat"></label>
          </form>
          <div class="actions">
            <button type="button" id="call-ai" class="btn-primary">Call AI</button>
          </div>
          <pre id="ai-response" class="output-block"></pre>
        </section>
      </div>
    </section>
  </main>

  <dialog id="library-dialog">
    <div class="dialog-header">
      <h2 id="dialog-title"></h2>
      <button type="button" id="close-dialog" aria-label="Close">&times;</button>
    </div>
    <div id="dialog-content"></div>
  </dialog>

  <!-- Onboarding overlay -->
  <dialog id="onboarding-dialog">
    <div class="dialog-header">
      <h2>Welcome to RGF</h2>
      <button type="button" id="onboarding-close" aria-label="Close">&times;</button>
    </div>
    <div id="onboarding-content">
      <ol class="onboarding-steps">
        <li><strong>Pick a vibe</strong>: set weights or choose a preset.</li>
        <li><strong>Mix genres</strong>: add 1–3 genres and weights.</li>
        <li><strong>Set premise & accent</strong>: optional language + accent.</li>
        <li><strong>Build Prompt</strong>: see outputs and copy blocks.</li>
      </ol>
      <div class="actions">
        <button type="button" id="onboarding-demo" class="btn-primary">Load Demo</button>
        <button type="button" id="onboarding-gotit">Got it</button>
      </div>
    </div>
  </dialog>

  <footer>
    <p>RGF web build &copy; iMob Worldwide &mdash; ported from the VBA module.</p>
  </footer>

  <!-- Toast notifications -->
  <div id="toast-root" aria-live="polite" aria-atomic="true"></div>
  <!-- Hidden directive for phonetic rewrites (not displayed) -->
  <div id="hidden-phonetic-directive" aria-hidden="true" style="display:none"></div>
  <script type="module" src="./app.js"></script>
</body>
</html>

